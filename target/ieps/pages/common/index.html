<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>大学生创新创业项目管理系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <link rel="icon" href="../favicon.ico">
    <link rel="stylesheet" href="../../static/layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="//at.alicdn.com/t/font_tnyc012u2rlwstt9.css" media="all"/>
    <link rel="stylesheet" href="../../static/css/main.css" media="all"/>

    <style>
        .closeBox .layui-nav-child dd.layui-this a {
            background-color: #fff;
        }
    </style>

</head>
<!--style="background-color: #5FB878;"-->
<body class="main_body">

<div class="layui-layout layui-layout-admin">
    <!-- 顶部 -->
    <div class="layui-header header" style="background-color: #2d4d94;">
        <div class="layui-main">
            <a href="#" class="logo">IEPS</a>
            <!-- 显示/隐藏菜单 -->
            <a href="javascript:;" class="iconfont hideMenu icon-menu1"></a>
            <!-- 天气信息 -->
            <div class="weather" pc>
                <div id="tp-weather-widget"></div>
                <script>(function (T, h, i, n, k, P, a, g, e) {
                    g = function () {
                        P = h.createElement(i);
                        a = h.getElementsByTagName(i)[0];
                        P.src = k;
                        P.charset = "utf-8";
                        P.async = 1;
                        a.parentNode.insertBefore(P, a)
                    };
                    T["ThinkPageWeatherWidgetObject"] = n;
                    T[n] || (T[n] = function () {
                        (T[n].q = T[n].q || []).push(arguments)
                    });
                    T[n].l = +new Date();
                    if (T.attachEvent) {
                        T.attachEvent("onload", g)
                    } else {
                        T.addEventListener("load", g, false)
                    }
                }(window, document, "script", "tpwidget", "//widget.seniverse.com/widget/chameleon.js"))</script>
                <script>tpwidget("init", {
                    "flavor": "slim",
                    "location": "WX4FBXXFKE4F",
                    "geolocation": "enabled",
                    "language": "zh-chs",
                    "unit": "c",
                    "theme": "chameleon",
                    "container": "tp-weather-widget",
                    "bubble": "disabled",
                    "alarmType": "badge",
                    "color": "#FFFFFF",
                    "uid": "U9EC08A15F",
                    "hash": "039da28f5581f4bcb5c799fb4cdfb673"
                });
                tpwidget("show");</script>
            </div>
            <!-- 顶部右侧菜单 -->
            <ul class="layui-nav top_menu">
                <li class="layui-nav-item lockcms" pc>
                    <a href="javascript:;"><i class="iconfont icon-lock1"></i><cite>锁屏</cite></a>
                </li>
                <!--<li class="layui-nav-item changeLanguage" pc>-->
                    <!--<a href="javascript:;"><i class="iconfont icon-lock1"></i><cite>中英互译</cite></a>-->
                <!--</li>-->
                <li class="layui-nav-item" pc>
                    <a href="javascript:;">
                        <img src="" class="layui-circle custom-img" width="35" height="35">
                        <cite class="userName"></cite>
                    </a>
                    <dl class="layui-nav-child">
                        <dd><a href="javascript:void(0)" data-url="/pages/basic/userInfo.html"><i class="layui-icon"
                                                                                                  data-icon="&#xe62a;">&#xe62a;</i><cite>个人资料</cite></a>
                        </dd>
                        <dd><a href="javascript:void(0)" data-url="/pages/basic/changePwd.html"><i class="layui-icon"
                                                                                                   data-icon="&#xe642;">&#xe642;</i><cite>修改密码</cite></a>
                        </dd>
                        <!--<dd><a href="javascript:void(0)" class="changeSkin"><i class="iconfont icon-huanfu"></i><cite>更换皮肤</cite></a>-->
                        <!--</dd>-->
                        <dd><a href="javascript:void(0)" class="signOut"><i
                                class="iconfont icon-loginout"></i><cite>退出</cite></a></dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>
    <!-- 左侧导航 -->
    <!--style="background-color: #596d44;"-->
    <!--class="layui-side layui-bg-black"-->
    <div class="layui-side" style="background-color: #053a71;">
        <div class="user-photo">
            <a class="img" title="更换头像"><img src="" class="custom-img"/></a>
            <p>你好！<span class="userName"></span>, 欢迎登录</p>
            <p class="uploadError"></p>
        </div>
        <div class="navBar layui-side-scroll"></div>
    </div>
    <!-- 右侧内容 -->
    <div class="layui-body layui-form">
        <div class="layui-tab marg0" lay-filter="bodyTab" id="top_tabs_box">
            <ul class="layui-tab-title top_tab" id="top_tabs">
                <li class="layui-this" lay-id=""><i class="iconfont icon-computer"></i><cite>欢迎页</cite></li>
            </ul>
            <ul class="layui-nav closeBox">
                <li class="layui-nav-item">
                    <a href="javascript:;"><i class="iconfont icon-caozuo"></i> 页面操作</a>
                    <dl class="layui-nav-child" style="">
                        <dd><a href="javascript:;" class="refresh refreshThis"><i class="layui-icon">&#x1002;</i>
                            刷新当前</a></dd>
                        <dd><a href="javascript:;" class="closePageOther"><i class="iconfont icon-prohibit"></i>
                            关闭其他</a></dd>
                        <dd><a href="javascript:;" class="closePageAll"><i class="iconfont icon-guanbi"></i> 关闭全部</a>
                        </dd>
                    </dl>
                </li>
            </ul>
            <div class="layui-tab-content clildFrame">
                <div class="layui-tab-item layui-show">
                    <iframe src="/pages/common/main.html"></iframe>
                </div>
            </div>
        </div>
    </div>
    <!-- 底部 -->
    <div class="layui-footer footer">
        <p>copyright @2019 Guet</p>
    </div>
</div>

<!-- 移动导航 -->
<!--<div class="site-tree-mobile layui-hide"><i class="layui-icon">&#xe602;</i></div>-->
<!--<div class="site-mobile-shade"></div>-->


<script src="../../static/js/jquery-1.9.1.min.js"></script>
<!-- 获取url参数 -->
<script src="../../static/js/getParam.js"></script>

<!-- 中英互译js  -->
<!--<script src="../../static/js/language.js"></script>-->

<!-- 加密和解密 -->
<script src="../../static/js/module/encrypt/aes.js"></script>
<script src="../../static/js/module/encrypt/customAesEncrypt.js"></script>

<!-- 图片和姓名自动更改 -->
<script>
    console.log($.Request("userNum"));
    console.log($.Request("roleId"));

    var userNumAdmin = decrypt($.Request("userNum"), "abcd1234abcd1234");
    var roleIdAdmin = decrypt($.Request("roleId"), "abcd1234abcd1234");
    var param = {
        userNum: userNumAdmin,
        roleId: roleIdAdmin
    };

    var userImg, userName, dataJson;

    function getMenu() {
        $.ajaxSettings.async = false;
        $.post("/getMenu.do", param, function (result) {
            if (result.status != 0) {
                return layer.msg(result.msg, {icon: 2});
            }
            dataJson = result.data;
        });
        $.ajaxSettings.async = true;

        return dataJson;
    }

    function getUserImg() {
        return userImg;
    }

    function getUserName() {
        return userName;
    }
</script>

<script>
    $(function () {
        $.get("/getUserInfo.do", param, function (result) {
            if (result.status != 0) {
                return layer.msg(result.msg, {icon: 2});
            }
            result = result.data;

            userImg = result.userImg;
            userName = result.userName;

            $(".custom-img").attr("src", result.userImg);
            $(".userName").text(result.userName);
        });
    });
</script>

<!-- 中英互译 -->
<script type="text/javascript">
//    $(".changeLanguage").click(function(){
//        translate();
//    });
</script>

<script type="text/javascript" src="../../static/layui/layui.js"></script>
<script type="text/javascript" src="../../static/js/module/menu/getMenu.js"></script>
<script type="text/javascript" src="../../static/js/module/menu/index.js"></script>

<!-- 更换头像 -->
<script>
    layui.use('upload', function () {
        var upload = layui.upload;

        //执行实例
        var changeUserImg = upload.render({
            elem: '.custom-img' //绑定元素
            , url: '/changeUserImg.do' //上传接口
            , data: param
            , choose: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('.custom-img').attr('src', result); //图片链接（base64）s
                });
            }
            , done: function (result) {
                if (result.status != 0) {
                    return layer.msg(result.msg);
                }
            }
            , error: function () {
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function () {
//                    uploadInst.upload();
                });
            }
            , accept: 'images'  // 上传文件类型
        })
    });
</script>

<script>

    layui.use(['bodyTab', 'form', 'element', 'layer'], function () {
        var form = layui.form,
            layer = layui.layer,
            element = layui.element;

        //锁屏
        function lockPage() {
            layer.open({
                title: false,
                type: 1,
                content: '	<div class="admin-header-lock" id="lock-box">' +
                '<div class="admin-header-lock-img"><img src="' + userImg + '"/></div>' +
                '<div class="admin-header-lock-name" id="lockUserName">' + userName + '</div>' +
                '<div class="input_btn">' +
                '<input type="password" class="admin-header-lock-input layui-input" autocomplete="off" placeholder="请输入密码解锁.." name="lockPwd" id="lockPwd" />' +
                '<button class="layui-btn" id="unlock">解锁</button>' +
                '</div>' +
                '<p>请输入账号密码，否则不会解锁成功哦！！！</p>' +
                '</div>',
                closeBtn: 0,
                shade: 0.9
            });
            $(".admin-header-lock-input").focus();
        }

        $(".lockcms").on("click", function () {
            window.sessionStorage.setItem("lockcms", true);
            lockPage();
        });

        // 判断是否显示锁屏
        if (window.sessionStorage.getItem("lockcms") == "true") {
            lockPage();
        }
        // 解锁
        $("body").on("click", "#unlock", function () {
            if ($(this).siblings(".admin-header-lock-input").val() == '') {
                layer.msg("请输入解锁密码！");
                $(this).siblings(".admin-header-lock-input").focus();
            } else {
                var userPwd = '123456';

                $.ajaxSettings.async = false;
                $.get("/getUserPwdWithUserNum.do", {userNum: userNumAdmin}, function (result) {
                    console.log(result);
                    if (result.status != 0) {
                        return;
                    }
                    userPwd = result.data.userPwd;
                });
                $.ajaxSettings.async = true;
                if ($(this).siblings(".admin-header-lock-input").val() == userPwd) {
                    window.sessionStorage.setItem("lockcms", false);
                    $(this).siblings(".admin-header-lock-input").val('');
                    layer.closeAll("page");
                } else {
                    layer.msg("密码错误，请重新输入！");
                    $(this).siblings(".admin-header-lock-input").val('').focus();
                }
            }
        });
        $(document).on('keydown', function () {
            if (event.keyCode == 13) {
                $("#unlock").click();
            }
        });

    });

</script>

</body>

</html>

